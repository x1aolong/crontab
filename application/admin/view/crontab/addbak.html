{include file="nav/_header" /}

<div class="wrapper wrapper-content">
    <div class="container">

        <div class="row">
            <div class="col-sm-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>添加定时任务 <small>请严格按照规定范围给时间值，超过会使命令失效，多个数值请用英文逗号分割 | <a href="https://www.osyunwei.com/archives/5039.html" target="_blank">点我学习命令</a></small></h5>
                        <div class="ibox-tools">
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                            <!--                            <a class="dropdown-toggle" data-toggle="dropdown" href="form_basic.html#">-->
                            <!--                                <i class="fa fa-wrench"></i>-->
                            <!--                            </a>-->
                            <!--                            <ul class="dropdown-menu dropdown-user">-->
                            <!--                                <li><a href="#">选项1</a>-->
                            <!--                                </li>-->
                            <!--                                <li><a href="#">选项2</a>-->
                            <!--                                </li>-->
                            <!--                            </ul>-->
                            <!--                            <a class="close-link">-->
                            <!--                                <i class="fa fa-times"></i>-->
                            <!--                            </a>-->
                        </div>
                    </div>


                    <div class="ibox-content">
                        <form method="get" class="form-horizontal">

                            <div class="form-group">
                                <label class="col-sm-2 control-label">分钟控制</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" name="minute" id="minute"> <span class="help-block m-b-none">此数据控制分钟，范围：0 - 59</span>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">小时控制</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" name="hour" id="hour"> <span class="help-block m-b-none">此数据控制小时，范围：0 - 23</span>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">日期控制</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" name="day" id="day"> <span class="help-block m-b-none">此数据控制日期，范围：1 - 31</span>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">月份控制</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" name="month" id="month"> <span class="help-block m-b-none">此数据控制月份，范围：1 - 12</span>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">周控制</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" name="week" id="week"> <span class="help-block m-b-none">此数据控制周，范围：0 - 6（0代表周日）</span>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>

                            <div class="form-group">
                                <label class="col-sm-2 control-label">脚本文件</label>
                                <div class="col-sm-10">
                                    <input type="file" class="form-control" name="shell"> <span class="help-block m-b-none">暂只支持.PHP脚本</span>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>

                            <div class="form-group">
                                <div class="col-sm-4 col-sm-offset-2">
                                    <button class="btn btn-primary submit-crontab">提交</button>
                                    <button class="btn btn-white back-to">返回</button>
                                </div>
                            </div>
                        </form>

                    </div>
                </div>
            </div>
        </div>
    </div>



</div>

</div>
<!--<div class="footer">-->
<!--    <div class="pull-right">-->
<!--        By：<a href="http://www.zi-han.net/" target="_blank">zihan's blog</a>-->
<!--    </div>-->
<!--    <div>-->
<!--        <strong>Copyright</strong> H+ &copy; 2014-->
<!--    </div>-->
<!--</div>-->
</div>
</div>

{include file="nav/_footer" /}

<script>
    $(function () {
        $('.submit-crontab').click(function () {
            // 未上传shell先进行拦截
            var shellFile = $("input[type=file]").val();
            if (shellFile === '') {
                layer.open({
                    title: '脚本文件',
                    content: '请上传脚本文件',
                    icon: 5,
                    anim: 6
                });
                return false;
            }
            // 封装数据
            var formdata = new FormData();
            formdata.append('file', $("input[type=file]")[0].files[0]);
            formdata.append('minute', $('#minute').val());
            formdata.append('hour', $('#hour').val());
            formdata.append('day', $('#day').val());
            formdata.append('month', $('#month').val());
            formdata.append('week', $('#week').val());

            $.ajax({
                url: "{:url('admin/Crontab/add')}",
                type: "post",
                data: formdata,
                contentType: false, //不设置内容类型
                processData: false, //不处理数据
                dataType: "JSON",
                success: function(data) {
                    // console.log(data);
                    if (data.code == 1) {
                        layer.msg(data.msg, {
                            icon: 6,
                            time: 2000
                        }, function () {
                            location.href = data.url;
                        });
                    } else {
                        layer.open({
                            title: '创建定时任务',
                            content: data.msg,
                            icon: 5,
                            anim: 6
                        });
                    }
                }
            });
            return false;
        });
    });

    $(function () {

        return false;
    });
</script>

</body>
<!--  /Body -->
</html>
